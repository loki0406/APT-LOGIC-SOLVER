<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>APT SOLVER </title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#9aa4b2;
      --accent:#6ee7b7;
      --glass: rgba(255,255,255,0.03);
      --glass-2: rgba(255,255,255,0.02);
      --glass-3: rgba(255,255,255,0.015);
      --radius:14px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#061325 0%, #07182a 60%); color:#e6eef6}
    .wrap{max-width:1200px;margin:36px auto;padding:28px;border-radius:18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); box-shadow:0 8px 30px rgba(2,6,23,0.7)}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    .logo{
      width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#60a5fa); display:flex;align-items:center;justify-content:center;font-weight:700;color:#032; font-size:20px;
      box-shadow:0 6px 18px rgba(96,165,250,0.12), inset 0 -6px 14px rgba(255,255,255,0.03);
    }
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns: 1fr 520px; gap:20px; margin-top:20px}
    @media (max-width:960px){ .grid{grid-template-columns:1fr} }
    .panel{background:var(--card); padding:16px;border-radius:12px;box-shadow:inset 0 1px 0 rgba(255,255,255,0.02)}
    textarea#jsonInput{width:100%;height:360px;background:var(--glass);border-radius:10px;border:1px solid rgba(255,255,255,0.03);padding:12px;color:#dff6e3;font-family:monospace;font-size:13px;resize:vertical}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn{
      background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      color:var(--accent); border:1px solid rgba(255,255,255,0.04); padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600;
      box-shadow:0 6px 18px rgba(9,12,20,0.5);transition:transform .12s ease, box-shadow .12s;
    }
    .btn:hover{transform:translateY(-3px)}
    .btn.primary{background:linear-gradient(90deg, #0ea5a0, #6ee7b7); color:#012; border:none}
    .filebox{display:flex;align-items:center;gap:10px}
    input[type=file]{display:none}
    label.filelabel{cursor:pointer;padding:8px 10px;border-radius:10px;background:var(--glass-2);border:1px dashed rgba(255,255,255,0.03);font-size:13px;color:var(--muted)}
    .small{font-size:13px;color:var(--muted)}
    .status{font-weight:700;color:var(--accent)}
    .results-section{
      display:grid;
      grid-template-columns: 1fr 260px;
      gap:14px;
    }
    @media(max-width:760px){ .results-section{grid-template-columns:1fr} }
    .results{display:grid;gap:12px;max-height:560px;overflow:auto;padding-right:6px;background:var(--card);padding:12px;border-radius:12px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.018), rgba(255,255,255,0.01)); padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
    .qtitle{font-weight:600;margin-bottom:8px}
    .options{display:flex;gap:8px;flex-wrap:wrap}
    .opt{padding:8px 10px;border-radius:10px;background:var(--glass-3);font-size:13px;border:1px solid rgba(255,255,255,0.02)}
    .opt.correct{background:linear-gradient(90deg, rgba(110,231,183,0.12), rgba(96,165,250,0.06)); border-color:rgba(110,231,183,0.22);color:var(--accent);font-weight:700}
    .meta{color:var(--muted);font-size:13px;margin-top:6px}
    footer{margin-top:18px;color:var(--muted);font-size:13px;display:flex;justify-content:space-between;align-items:center}
    .loader{display:inline-block;width:14px;height:14px;border-radius:50%;background:linear-gradient(90deg,#60a5fa,#6ee7b7);animation:spin 1s linear infinite;opacity:0}
    .loader.active{opacity:1}
    @keyframes spin { 0%{transform:translateY(0)} 50%{transform:translateY(-6px)} 100%{transform:translateY(0)} }

    /* Answers-only card (side by side) */
    .answers-only {
      background:var(--card);
      border-radius:12px;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
      height:560px;
      overflow:auto;
    }
    .answers-only h3{margin:0;font-size:15px;color:var(--accent)}
    .ans-item{display:flex;align-items:center;gap:10px;padding:8px;border-radius:10px;background:var(--glass-3);border:1px solid rgba(255,255,255,0.02)}
    .ans-number{width:28px;height:28px;border-radius:6px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;font-weight:700}
    .ans-text{font-weight:600;font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">APT</div>
      <div>
        <h1>APT LOGIC SOLVER </h1>
        <p class="lead">Paste or upload <code>questions.json</code>. Backend verifies correct options via bcrypt and shows results beside the compact Answers card.</p>
      </div>
    </header>

    <div class="grid">
      <div class="panel">
        <strong>Input JSON</strong>
        <div class="small">Paste file content or upload <code>questions.json</code></div>
        <textarea id="jsonInput" placeholder='Paste questions.json content here...'></textarea>

        <div class="controls">
          <div class="filebox">
            <label class="filelabel" for="fileInput">Choose JSON file</label>
            <input id="fileInput" type="file" accept=".json" />
            <span class="small" id="fileName"></span>
          </div>
          <button id="formatBtn" class="btn">Format JSON</button>
          <button id="clearBtn" class="btn">Clear</button>
          <button id="sendBtn" class="btn primary">Run & Get Answers</button>
        </div>

        <div style="margin-top:12px;color:var(--muted);font-size:13px">
          Backend: <span class="status">http://127.0.0.1:5000</span> <span class="loader" id="busy"></span>
        </div>
      </div>

      <div class="results-section">
        <div>
          <h3>Full Results</h3>
          <div id="results" class="results"></div>
        </div>
        <div class="answers-only">
          <h3>Answers Only</h3>
          <div id="answersList"></div>
        </div>
      </div>
    </div>

    <footer>
      <div>Built with ❤️ by AI </div>
      <div class="small">Local Flask backend connected</div>
    </footer>
  </div>

<script>
const fileInput = document.getElementById('fileInput');
const jsonInput = document.getElementById('jsonInput');
const fileName = document.getElementById('fileName');
const sendBtn = document.getElementById('sendBtn');
const resultsEl = document.getElementById('results');
const answersList = document.getElementById('answersList');
const busy = document.getElementById('busy');
const formatBtn = document.getElementById('formatBtn');
const clearBtn = document.getElementById('clearBtn');

const BACKEND = 'http://127.0.0.1:5000/api/solve';

fileInput.addEventListener('change', async e=>{
  const f = e.target.files[0];
  if(!f)return;
  fileName.textContent=f.name;
  jsonInput.value=await f.text();
});

formatBtn.addEventListener('click',()=>{
  try{
    const obj=JSON.parse(jsonInput.value);
    jsonInput.value=JSON.stringify(obj,null,2);
  }catch(e){alert('Invalid JSON');}
});
clearBtn.addEventListener('click',()=>{
  jsonInput.value=''; fileName.textContent='';
  resultsEl.innerHTML=''; answersList.innerHTML='';
});

sendBtn.addEventListener('click',async()=>{
  const text=jsonInput.value.trim();
  if(!text){alert('Paste or upload JSON first');return;}
  busy.classList.add('active'); sendBtn.disabled=true;
  try{
    const data=JSON.parse(text);
    const resp=await fetch(BACKEND,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
    const res=await resp.json();
    if(!res.ok) throw new Error(res.error);
    renderResults(res.results); renderAnswers(res.results);
  }catch(e){alert('Error: '+e.message);}
  finally{busy.classList.remove('active'); sendBtn.disabled=false;}
});

function renderResults(results){
  resultsEl.innerHTML='';
  results.forEach((r,i)=>{
    const card=document.createElement('div');card.className='card';
    card.innerHTML=`
      <div class="qtitle">${i+1}. ${escapeHtml(r.question||'')}</div>
      <div class="options">
        ${(r.options||[]).map(o=>`<div class="opt ${o===r.correct?'correct':''}">${escapeHtml(o)}</div>`).join('')}
      </div>
      <div class="meta">${r.correct?'✅ '+escapeHtml(r.correct):'❌ Not found'}</div>`;
    resultsEl.appendChild(card);
  });
}
function renderAnswers(results){
  answersList.innerHTML='';
  results.forEach((r,i)=>{
    const item=document.createElement('div');item.className='ans-item';
    item.innerHTML=`<div class="ans-number">${i+1}</div><div class="ans-text">${r.correct?escapeHtml(r.correct):'<span style="color:#ff8b8b">Not found</span>'}</div>`;
    answersList.appendChild(item);
  });
}
function escapeHtml(s){return (s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]));}
</script>
</body>
</html>
